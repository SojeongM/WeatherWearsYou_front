<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Wears You</title>
    <link href="https://fonts.googleapis.com/css2?family=Prata&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/chat.css">
    <link rel="icon" href="./img/logo.png">
</head>

<body>
    <header>
        
    </header>
    <main>
        <div id="top">
            Weather Wears You
        </div>
        <div id="container">
            <section id="info">
                <section id="date">
                    <script lang="javascript">
                        var date = sessionStorage.getItem('date');
                        var loc = sessionStorage.getItem('location');


                        var Arr = Array("sejong", "chungnam", "jeju", "gyeongnam", "gyeongbuk",
     				"jeonbuk", "chungbuk", "gangwon", "gyeonggi", "jeonnam",
     				"ulsan", "busan", "daegu", "daejeon", "incheon", "seoul",
     				"gwangju");
    
    
     		var strArr = Array("세종특별자치시", "충청남도", "제주특별자치도", "경상남도", "경상북도",
    				"전라북도", "충청북도", "강원도", "경기도", "전라남도", "울산광역시", "부산광역시",
     				"대구광역시", "대전광역시", "인천광역시", "서울특별시", "광주광역시");
            
            //alert(city_do);
     		var idx = Arr.indexOf(loc);
            //alert(strArr[idx]);
           
            
            //console.log(city_do)
            

                        document.write(date.slice(4, 6) + "월 " + date.slice(6) + "일 " + strArr[idx]);
                        
                    </script>
                  
                </section>
                
                <section id="weather">
                    <section id="temp">
                        <script lang="javascript">
                            var t1 = Math.round(sessionStorage.getItem("minTemp"));
                            var t2 = Math.round(sessionStorage.getItem("maxTemp"));
                            document.write("최저온도: " + t1 + "°C<br>최고온도: " + t2 + "°C");
                        </script>
                        <br>
                    </section>
                    
                    <section id="icon">
                        <img id="weather-image" src="" alt="Weather Image" style="display: none; width: 250px; height: 250px;">
      
                    </section>
                    <section id="detail">
                        <script lang="javascript"> 
                            var precipitationRate = sessionStorage.getItem("precipitationRate");
                            var weather = sessionStorage.getItem("weather");
                            document.write("강수확률: " + precipitationRate + " %<br>");
                            document.write("날씨: " + weather);
                        </script>
                    </section>
                    
                </section>
            </section>
            <section id="mid">
                
                <button id="search" onclick="location.href='select.html'">
                    <a href="select.html"
                            style="background-color: rgb(255, 255, 255); 
                            color: rgb(0, 0, 0)"
                            >&nbsp;&nbsp;&nbsp;&nbsp; search ...</a>
                    
                </button>

                <section id="img">
                    <img src="./img/search.jpg" width="100%" height="100%">
                </section>
            </section>

            <section id="bottom">
                <section id="recommendation">
                    ChatGPT's recommendation
                </section>
                <section id="chat">
                    <section id="boxLoading"></section>
    
                    <div class="u">
                        <section id="usericon">
                            <img style="background-color: rgb(255, 255, 255)" src="./img/user.png" width="100%" height="auto"  >
                        </section>
                        <section id="blank">
    
                        </section>
                        <section id="user">
                            <section id="userchat">
                                <script lang="javascript">
                                    var date = sessionStorage.getItem('date');
                                    var mon = date.slice(4, 6); // extract the month part
                                    var d = date.slice(6); // extract the day part
                                    document.write(mon + "월 " + d + "일 옷차림 추천해줘");
                                </script>
                            </section>                            
                            
                        </section>
                    
                    </div>
                    <div class="g">
     
                        <section id="gpt">
                            <section id="gptchat">
                                
                           </section>
                            
                        </section>
                        <section id="blank">
                            
                        </section>
                        <section id="gpticon">
                            <img style="background-color: rgb(255, 255, 255)" src="./img/gpt.jpg" width="110%" height="110%">
                        </section>
                    </div>
                    
                    
                </section>
            
            
        </div>

            
    </main>
    <footer>
            
    </footer>
</div>

<script>

    
    function getGPTChat() {
        // Assuming gender and targetDate are available
        var gender = sessionStorage.getItem("newGender"); // Replace with actual value
        var targetDate = sessionStorage.getItem("date"); // Replace with actual value
        var city = sessionStorage.getItem("location");

        var weather = sessionStorage.getItem("weather");
        var weatherImage = document.getElementById("weather-image");
        switch (weather) {
        case "sunny":
          weatherImage.src = "weather_img/sunny.png";
          weatherImage.style.display = "block";
          break;
        case "rainy":
          weatherImage.src = "weather_img/rainy.png";
          weatherImage.style.display = "block";
          break;
        case "cloudy":
        weatherImage.src = "weather_img/cloudyy.png";
        weatherImage.style.display = "block";
          break;
        case "blurry":
        weatherImage.src = "weather_img/blurry1.png";
        weatherImage.style.display = "block";
          break;
        case "snowy":
        weatherImage.src = "weather_img/snowy.png";
        weatherImage.style.display = "block";
          break;
        case "stormy":
        weatherImage.src = "weather_img/stormy.png";
        weatherImage.style.display = "block";
          break;
        default:
          weatherImage.src = "path/to/default-image.jpg";
          weatherImage.style.display = "block";
          break;
      }






        // Form data
        var formData = new FormData();
        formData.append("city", city);
        formData.append("gender", gender);
        formData.append("targetDate", targetDate);

        let loader = `<img style="border-radius: 25px; background-color: rgb(255, 255, 255)" src="./img/loadingimg.gif" width="100%" height="100%" >`;
        document.getElementById('boxLoading').innerHTML = loader;
        const div1=document.getElementById('usericon');
        const div2=document.getElementById('user');
        const div3=document.getElementById('gpticon');
        const div4=document.getElementById('gpt');
        const div5=document.getElementById('blank');
        div1.style.display='none';
        div2.style.display='none';
        div3.style.display='none';
        div4.style.display='none';
        div5.style.display='none';

        // Fetch request
        fetch("http://localhost:8080", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            const ele=document.getElementById('boxLoading');
            ele.remove();
            div1.style.display='block';
            div2.style.display='block';
            div3.style.display='block';
            div4.style.display='block';
            div5.style.display='block';
            var chat = "오늘의 GPT 옷장 추천<br>";
            for (const [key, value] of Object.entries(data)) {
                chat += key + ": " + value.join(", ") + "<br>";
            }
            
            document.getElementById("gptchat").innerHTML = chat;
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function weather_img(weather){
    //var weather=sessionStorage.getItem(weather);
        console.log(sessionStorage.getItem(location));
        console.log("1");
        
    }

     getGPTChat(); // Call the function

</script>
</body>
</html>