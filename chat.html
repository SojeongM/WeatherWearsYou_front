<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Wears You</title>
    <link href="https://fonts.googleapis.com/css2?family=Prata&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./css/chat.css">
    <link rel="icon" href="./img/logo.png">
</head>

<body>
    <header>
        
    </header>
    <main>
        <div id="top">
            Weather Wears You
        </div>
        <div id="container">
            <section id="info">
                <section id="date">
                    <script lang="javascript">
                        var date = sessionStorage.getItem('date');
                        var loc = sessionStorage.getItem('location');
                        document.write(date.slice(4, 6) + "월 " + date.slice(6) + "일 " + loc);
                        
                    </script>
                  
                </section>
                
                <section id="weather">
                    <section id="temp">
                        <script lang="javascript">
                            var t1 = Math.round(sessionStorage.getItem("mintemp"));
                            var t2 = Math.round(sessionStorage.getItem("maxtemp"));
                            document.write("lowest: " + t1 + "°C<br>highest: " + t2 + "°C");
                        </script>
                        <br>
                    </section>
                    
                    <section id="icon">
                        
                    </section>
                    <section id="detail">
                        <script lang="javascript"> 
                            var precipitationRate = sessionStorage.getItem("precipitationRate");
                            var weather = sessionStorage.getItem("weather");
                            document.write("Precipitation Rate: " + precipitationRate + " %<br>");
                            document.write("Weather: " + weather);
                        </script>
                    </section>
                    
                </section>
            </section>
            <section id="mid">
                
                <section id="search">
                    <a href="select.html"
                            style="background-color: rgb(255, 255, 255); 
                            color: rgb(0, 0, 0)"
                            >&nbsp;&nbsp;&nbsp;&nbsp; search ...</a>
                    
                </section>

                <section id="img">
                    <img src="./img/search.jpg" width="100%" height="100%">
                </section>
            </section>

            <div class="bottom">
                <section id="recommendation">
                    ChatGPT's recommendation
                </section>
                <section id="chat">
                    
    
                    <div class="u">
                        <section id="usericon">
                            <img src="./img/user.png" width="100%" height="100%"  >
                        </section>
                        <section id="blank">
    
                        </section>
                        <section id="user">
                            <section id="userchat">
                                <script lang="javascript">
                                    var date = sessionStorage.getItem('date');
                                    var mon = date.slice(4, 6); // extract the month part
                                    var d = date.slice(6); // extract the day part
                                    document.write(mon + "월 " + d + "일 옷차림 추천해줘");
                                </script>
                            </section>                            
                            
                        </section>
                    
                    </div>
                    <div class="g">
     
                        <section id="gpt">
                            <section id="gptchat">
                                
                           </section>
                            
                        </section>
                        <section id="blank">
                            
                        </section>
                        <section id="gpticon">
                            <img src="./img/gpt.jpg" width="100%" height="100%">
                        </section>
                    </div>
                    
                    
                </section>
            </div>
            
        </div>

            
    </main>
    <footer>

    </footer>
</div>

<script>
    function getGPTChat() {
        // Assuming gender and targetDate are available
        var gender = sessionStorage.getItem("newGender"); // Replace with actual value
        var targetDate = sessionStorage.getItem("date"); // Replace with actual value
        var city = sessionStorage.getItem("location");

        // Form data
        var formData = new FormData();
        formData.append("city", city);
        formData.append("gender", gender);
        formData.append("targetDate", targetDate);

        // Fetch request
        fetch("http://localhost:8080", {
            method: "POST",
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            var chat = "오늘의 GPT 옷장 추천<br>";
            for (const [key, value] of Object.entries(data)) {
                chat += key + ": " + value.join(", ") + "<br>";
            }
            document.getElementById("gptchat").innerHTML = chat;
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    getGPTChat(); // Call the function
</script>
</body>
</html>