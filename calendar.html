<!DOCTYPE html>
<html>
  <head>
    <link href="https://fonts.googleapis.com/css2?family=Prata&display=swap" rel="stylesheet">
    <meta charset="utf-8">
    <title>Weather Information</title>
    <style>
      @font-face {
    font-family: 'NanumSquareNeo-Variable';
    src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_11-01@1.0/NanumSquareNeo-Variable.woff2') format('woff2');
    font-weight: normal;
    font-style: normal;
}
*{
  font-family: 'NanumSquareNeo-Variable';
}

#top{
    height: 150px;
    background-color: rgb(255, 255, 255);
    text-align: center;
    line-height: 40px;
    color:rgb(6, 54, 188);
    font-family: 'Prata', cursive;
    font-size: 50px;
   
}
header{
    height: 150px;
    width: 100%;
    background-color: rgb(255, 255, 255);
}

#date-picker {
  margin-top: 100px;
  margin-bottom:100px;
  font-size: 20px;
  width: 700px;
  height: 50px;
  font-size:80px;
  font-family: 'NanumSquareNeo-Variable';
}

body {
  background-color: #ffffff; /* set the background color to a light blue */
  font-family: 'NanumSquareNeo-Variable'; /* set the font family for the entire page */
}

h1 {
  color: rgb(0, 42, 196); /* set the color of the heading to white */
  text-align: center; /* center the heading text */
  /*text-shadow: 2px 2px 4px #000000; /* add a text shadow for emphasis */
}

h2 {
  color: white;
  text-align: center;
  font-size: 40px;
}

p {
  color: rgb(0, 0, 0); /* set the color of paragraphs to a dark grey */
  font-size: 50px; /* set the font size for paragraphs */
  line-height: 1.0; /* set the line height to improve readability */
  text-align: center;
  font-family: 'NanumSquareNeo-Variable';
}

input[type=date] {
  display: block; /* make them block elements */
  margin: 0 auto; /* center them horizontally */
  margin-left: 150px;
  margin-top: 20px; /* add some top margin */
  padding: 50px; /* increase padding */
}

button {
  font-size:40px;
  display: block; /* make them block elements */
  margin: 0 auto; /* center them horizontally */
  margin-top: 20px; /* add some top margin */
  cursor: pointer; /* add a pointer cursor on hover */
  width:350px;
  height: 80px;
  border-radius:0.5rem;
  background-color: rgb(249, 214, 155);
  border:none;
}

button:hover {
  background-color: rgb(249, 214, 155); /* darken the background color on hover */
  
}

#weather-info {
  margin-top: 100px; /* add some space between the button and the weather information */
  text-align: center;

}

img {
  display: block; /* make the weather icon a block element */
  margin: 0 auto; /* center the weather icon */
  width: 300px;
  height: 300px;
  margin-bottom: 850px;
}

#weather-box {
  background-color: rgb(82, 127, 250); /* set the background color to blue */
  color: white; /* set the text color to white */
  padding: 20px; /* add some padding to the box */
  border-radius: 3rem; /* round the corners of the element */
  width: 800px; /* set the width of the box */
  height: 1000px;
  margin: 0 auto; /* center the box */
  margin-top: 100px;
  margin-bottom: 100px;
  align-items: center;
  font-family: 'NanumSquareNeo-Variable';
}
#intro{
  
	background-color: rgb(255, 255, 255);
	font-size: 75px;
    line-height: 5rem;
	//font-style: italic;
	text-align: center;
	font-family: 'NanumSquareNeo-Variable';
	color: rgb(24, 24, 185);
}

</style>

</head>
<body>
    <header>
      
    </header>
    
    <div id="top">Weather wears you</div>
    <p><section id=intro>날짜를 선택하세요</section></p>
    <input type="date" id="date-picker" min="" max="" onchange="checkDateAvailability()">
    <button onclick="getWeather()">Get Weather</button>
    
    <div id="weather-box">
      <h2>Weather information</h2>
      <div id="weather-info"></div>
    </div>
    <button onclick="navigateToNextPage()">Next Page</button>
    
    <script>
      var minDate = new Date();
      var maxDate = new Date();
      maxDate.setDate(maxDate.getDate() + 9);
      document.getElementById("date-picker").min = minDate.toISOString().slice(0, 10);
      document.getElementById("date-picker").max = maxDate.toISOString().slice(0, 10);

      function checkDateAvailability() {
  var selectedDate = new Date(document.getElementById("date-picker").value);
  var today = new Date();
  if (selectedDate > maxDate) {
    document.getElementById("date-picker").value = "";
    alert("Please select a date between " + (today.getMonth() + 1) + "/" + today.getDate() + "/" + today.getFullYear() + " and " + (maxDate.getMonth() + 1) + "/" + maxDate.getDate() + "/" + maxDate.getFullYear());
  }
}


      function getWeather() {
        var selectedDate = new Date(document.getElementById("date-picker").value);
        var url = `http://localhost:8080/weather/$seoul?targetDate=20230520`;
        fetch(url)
          .then(response => {
            
            if(response.ok) {
                return response.json();
            }  
            throw new Error('Network response was not ok.');
            })
          .then(data => {
            console.log(JSON.stringify(data));
            var forecasts = data.list;
            var filteredForecasts = forecasts.filter(function(forecast) {
              return forecast.dt_txt.slice(0, 10) === selectedDate.toISOString().slice(0, 10);
            });
            if (filteredForecasts.length === 0) {
              alert("Sorry, weather information is not available for the selected date.");
              return;
            }
            if(sessionStorage.getItem('date')){
              sessionStorage.removeItem('date');
            }
            console.log();
            var storedate=(selectedDate.getFullYear().toString()+("00"+(selectedDate.getMonth()+1).toString()).slice(-2)+("00"+(selectedDate.getDate()).toString()).slice(-2));
            sessionStorage.setItem('date', storedate);
            var forecast = filteredForecasts[0];
            var temperature = forecast.main.temp;
            var minTemperature = forecast.main.temp_min;
            var maxTemperature = forecast.main.temp_max;
            var description = forecast.weather[0].description;
            var iconCode = forecast.weather[0].icon;
            var iconUrl = "http://openweathermap.org/img/w/" + iconCode + ".png";
            var weatherInfo = document.getElementById("weather-info");
            weatherInfo.innerHTML = "<p>Temperature: " + temperature + " &#8451;</p><p>Minimum Temperature: " + minTemperature + " &#8451;</p><p>Maximum Temperature: " + maxTemperature + " &#8451;</p><p>Description: " + description + "</p><img src='" + iconUrl + "' alt='weather icon'>";
            sessionStorage.setItem("maxtemp", maxTemperature);
            sessionStorage.setItem("mintemp", minTemperature);
          })
          .catch(error => {
            console.error('Error:', error);
          });
      }
      function navigateToNextPage() {
          // Perform the desired action
          window.location.href = "chat.html";
        }
    
    </script>
  </body>
</html>
